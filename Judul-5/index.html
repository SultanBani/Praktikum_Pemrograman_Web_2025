<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Interaktif</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container calculator-container">
        <div class="calculator">
            <div class="display-container">
                <div class="memory-indicator" id="memoryIndicator"></div>
                <div class="history-display" id="historyDisplay"></div>
                <div class="display" id="display">0</div>
            </div>
          
            <div class="row mb-2">
                <div class="col-3">
                    <button class="btn btn-calc btn-memory" onclick="memoryAdd()">M+</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-memory" onclick="memorySubtract()">M-</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-memory" onclick="memoryRecall()">MR</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-memory" onclick="memoryClear()">MC</button>
                </div>
            </div>

            <div class="row">
                <div class="col-6">
                    <button class="btn btn-calc btn-clear" onclick="clearEntry()">CE</button>
                </div>
                <div class="col-6">
                    <button class="btn btn-calc btn-clear" onclick="clearAll()">C</button>
                </div>
            </div>

            <div class="row">
                <div class="col-3">
                    <button class="btn btn-calc btn-number" onclick="appendNumber('7')">7</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-number" onclick="appendNumber('8')">8</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-number" onclick="appendNumber('9')">9</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-operator" onclick="setOperator('÷')">÷</button>
                </div>
            </div>

            <div class="row">
                <div class="col-3">
                    <button class="btn btn-calc btn-number" onclick="appendNumber('4')">4</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-number" onclick="appendNumber('5')">5</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-number" onclick="appendNumber('6')">6</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-operator" onclick="setOperator('×')">×</button>
                </div>
            </div>

            <div class="row">
                <div class="col-3">
                    <button class="btn btn-calc btn-number" onclick="appendNumber('1')">1</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-number" onclick="appendNumber('2')">2</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-number" onclick="appendNumber('3')">3</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-operator" onclick="setOperator('-')">-</button>
                </div>
            </div>

            <div class="row">
                <div class="col-3">
                    <button class="btn btn-calc btn-number" onclick="appendNumber('0')">0</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-number" onclick="appendNumber('.')">.</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-equals" onclick="calculate()">=</button>
                </div>
                <div class="col-3">
                    <button class="btn btn-calc btn-operator" onclick="setOperator('+')">+</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentValue = '0';
        let expression = '';
        let history = [];
        let memory = 0;

        const display = document.getElementById('display');
        const memoryIndicator = document.getElementById('memoryIndicator');
        const historyDisplay = document.getElementById('historyDisplay');

        function updateDisplay() {
            if (expression === '') {
                display.textContent = currentValue;
            } else {
                display.textContent = expression + ' ' + currentValue;
            }
        }

        function updateMemoryIndicator() {
            memoryIndicator.textContent = memory !== 0 ? `M: ${memory}` : '';
        }

        function updateHistoryDisplay() {
            if (history.length === 0) {
                historyDisplay.innerHTML = '';
                return;
            }

            const historyHTML = history.map((item, index) => 
                `<div class="history-item-inline" onclick="useHistoryResult(${index})">${item}</div>`
            ).join('');
            
            historyDisplay.innerHTML = historyHTML;
        }

        function appendNumber(num) {
            if (num === '.' && currentValue.includes('.')) return;
            
            if (currentValue === '0' && num !== '.') {
                currentValue = String(num);
            } else {
                currentValue += String(num);
            }
            updateDisplay();
        }

        function setOperator(op) {
            if (currentValue === '' || currentValue === '-') return;
            
            if (expression === '') {
                expression = currentValue;
            } else {
                expression += ' ' + currentValue;
            }
            
            expression += ' ' + op;
            currentValue = '0';
            updateDisplay();
        }

        function evaluateExpression(expr) {
            expr = expr.replace(/×/g, '*').replace(/÷/g, '/');
            
            try {
                let result = Function('"use strict"; return (' + expr + ')')();
                
                if (!isFinite(result)) {
                    throw new Error('Pembagian dengan nol');
                }
                
                result = Math.round(result * 100000000) / 100000000;
                return result;
            } catch (e) {
                throw new Error('Error dalam perhitungan');
            }
        }

        function calculate() {
            if (expression === '') return;
            
            try {
                const fullExpression = expression + ' ' + currentValue;
                
                const result = evaluateExpression(fullExpression);
                
                addToHistory(`${fullExpression} = ${result}`);
                
                currentValue = String(result);
                expression = '';
                updateDisplay();
            } catch (e) {
                alert('Error: ' + e.message);
                clearAll();
            }
        }

        function clearAll() {
            currentValue = '0';
            expression = '';
            updateDisplay();
        }

        function clearEntry() {
            currentValue = '0';
            expression = '';
            history = [];
            updateDisplay();
            updateHistoryDisplay();
        }

        function memoryAdd() {
            memory += parseFloat(currentValue);
            updateMemoryIndicator();
        }

        function memorySubtract() {
            memory -= parseFloat(currentValue);
            updateMemoryIndicator();
        }

        function memoryRecall() {
            currentValue = String(memory);
            expression = '';
            updateDisplay();
        }

        function memoryClear() {
            memory = 0;
            updateMemoryIndicator();
        }

        function addToHistory(calculation) {
            history.unshift(calculation);
            if (history.length > 5) {
                history.pop();
            }
            updateHistoryDisplay();
        }

        function useHistoryResult(index) {
            const calculation = history[index];
            const result = calculation.split('= ')[1];
            currentValue = result;
            expression = '';
            updateDisplay();
        }

        document.addEventListener('keydown', function(e) {
            if (e.key >= '0' && e.key <= '9') {
                appendNumber(e.key);
            } else if (e.key === '.') {
                appendNumber('.');
            } else if (e.key === '+') {
                setOperator('+');
            } else if (e.key === '-') {
                setOperator('-');
            } else if (e.key === '*') {
                setOperator('×');
            } else if (e.key === '/') {
                e.preventDefault();
                setOperator('÷');
            } else if (e.key === 'Enter' || e.key === '=') {
                e.preventDefault();
                calculate();
            } else if (e.key === 'Escape' || e.key === 'c' || e.key === 'C') {
                clearAll();
            } else if (e.key === 'Backspace') {
                clearEntry();
            }
        });
        updateDisplay();
    </script>
</body>
</html>